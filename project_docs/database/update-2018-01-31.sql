INSERT INTO `reporte` (`idreporte`, `titulo`, `descripcion`, `categoria`, `plantilla`, `sql`, `parametros`) VALUES
(8, 'Captura de Manifiestos', 'Captura de Manifiestos con base en la fecha de captura y el capturista', 'Manifiestos', 'rep_captura_manifiestos.xlsx', 
'select \n	DATE_FORMAT( m.fecha_captura,''%d/%m/%Y %H:%i'') as Fecha_Captura,\n	m.identificador as Manifiesto,\n    m.capturista as Capturista,\n    sum( r.cantidad ) as Cantidad\nfrom manifiesto m\n	inner join relmanrec using( idmanifiesto )\n    inner join recoleccion r using( idrecoleccion )\n__WHR__\ngroup by m.idmanifiesto\norder by m.fecha_captura', 
'[{\r\n	"parametro": "fecha_captura_inicio",\r\n	"campo": "m.fecha_captura",\r\n	"tipo": "date",\r\n	"etiqueta": "Fecha Inicial",\r\n	"default": "_HOY_",\r\n	"operador": ">="\r\n},\r\n{\r\n	"parametro": "fecha_captura_final",\r\n	"campo": "m.fecha_captura",\r\n	"tipo": "date",\r\n	"etiqueta": "Fecha Final",\r\n	"default": "_HOY_+365",\r\n	"operador": "<="\r\n},\r\n{\r\n	"parametro": "capturista",\r\n	"campo": "m.capturista",\r\n	"tipo": "text",\r\n	"etiqueta": "Capturista",\r\n	"default": "",\r\n	"operador": "like"\r\n}]');

INSERT INTO `permiso` (`idpermiso`, `nombre`, `descripcion`, `permisopadre`) VALUES
(128, 'Reporte de Captura', 'Reporte de Captura de manifiestos', 101);

INSERT INTO `relpermperf` (`idpermiso`, `idperfil`) VALUES
(128, 1),
(128, 3),
(128, 4),
(128, 5),
(128, 6),
(128, 8);

UPDATE reporte SET 
	`sql` = 'select \n	DATE_FORMAT( m.fecha_captura,''%d/%m/%Y %H:%i'') as Fecha_Captura,\n	DATE_FORMAT( m.fecha,''%d/%m/%Y %H:%i'') as Fecha_Programada,\n	DATE_FORMAT( m.fechaembarque,''%d/%m/%Y %H:%i'') as Fecha_Embarque,\n	m.identificador as Manifiesto,\n    m.capturista as Capturista,\n    sum( r.cantidad ) as Cantidad,\n    mot.catalogo as Tipo_Incidencia,\n    mot.opcion as Incidencia,\nm.observacionesdestinofinal as Observaciones\nfrom manifiesto m\n	inner join relmanrec using( idmanifiesto )\n    inner join recoleccion r using( idrecoleccion )\n    left join v_catalogo mot on mot.idopcion = m.motivo\n__WHR__\ngroup by m.idmanifiesto\norder by m.fecha_captura'
	WHERE idreporte = 8;
	
UPDATE reporte SET
	`sql` = 'SELECT\nemp.razonsocial AS ''Empresa'',\nsuc.nombre AS ''Sucursal'',\ncl.identificador AS ''No. Cte.'',\ngen.identificador AS ''No. Gen.'',\ngen.razonsocial AS ''Generador'',\nDATE_FORMAT(cl.fechaalta,''%d/%m/%Y'') AS ''Fecha de ingreso'',\nman.identificador AS ''Manifiesto'',\n'''' AS ''No. manifiesto Tercero'',\nDATE_FORMAT(man.fecha,''%d/%m/%Y'') AS ''Fecha Programada de Servicio'',\nDATE_FORMAT(man.fechaembarque,''%d/%m/%Y'') AS ''Fecha de Embarque'',\nROUND(SUM(IF(res.nombre LIKE ''Sangre'',rec.cantidad,0.0)),2) AS ''Sangre'',\nROUND(SUM(IF(res.nombre LIKE ''Cultivos y Cepas'',rec.cantidad,0.0)),2) AS ''Cultivos y cepas'',\nROUND(SUM(IF(res.nombre LIKE ''Patológicos'',rec.cantidad,0.0)),2) AS ''Patologicos'',\nROUND(SUM(IF(res.nombre LIKE ''No Anatónmicos'',rec.cantidad,0.0)),2) AS ''No Anatomicos'',\nROUND(SUM(IF(res.nombre LIKE ''Objetos Punzocortantes'',rec.cantidad,0.0)),2) AS ''Punzocortantes'',\nROUND(SUM(IF(res.nombre LIKE ''%medicamento%'',rec.cantidad,0.0)),2) AS ''Medicamento caduco'',\nROUND(SUM(IF(res.nombre LIKE ''%revelador%'',rec.cantidad,0.0)),2) AS ''Revelador'',\nROUND(SUM(IF(res.nombre LIKE ''%fijador%'',rec.cantidad,0.0)),2) AS ''Fijador'',\nROUND(SUM(IF(res.nombre LIKE ''%placa%plomo%'',rec.cantidad,0.0)),2) AS ''Placas de Plomo'',\nROUND(SUM(IF(res.nombre LIKE ''%xilol%'',rec.cantidad,0.0)),2) AS ''Xilol'',\nROUND(SUM(IF(res.nombre LIKE ''%formol%'',rec.cantidad,0.0)),2) AS ''Formol'',\nROUND(SUM(IF(res.nombre LIKE ''%fenol%'',rec.cantidad,0.0)),2) AS ''Fenol y Agua'',\nROUND(SUM(rec.cantidad),2) AS ''Total'',\n#res.nombre,\n#rec.cantidad,\n'''' AS ''Causa'',\ncmot.descripcion AS ''Motivo'',\nman.observacionesdestinofinal AS ''Observaciones'',\ncvend.descripcion AS ''Vendedor'',\ncfrec.descripcion AS ''Frecuencia'',\nIF(cl.facturaxgenerador=0,cl.cobranzaemail,gen.cobranzaemail) AS ''Correo Electrónico'',\nIF(cl.facturaxgenerador=0,GROUP_CONCAT(ctservcl.descripcion SEPARATOR '' | ''),GROUP_CONCAT(ctservgen.descripcion SEPARATOR '' | '')) AS ''Tipo de Servicio'',\nIF(cl.facturaxgenerador=0,GROUP_CONCAT(ctcobcl.descripcion SEPARATOR '' | ''),GROUP_CONCAT(ctcobgen.descripcion SEPARATOR '' | '')) AS ''Tipo de Cobro'',\nIF(cl.facturaxgenerador=0,GROUP_CONCAT(faccl.precio SEPARATOR '' | ''),GROUP_CONCAT(facgen.precio SEPARATOR '' | '')) AS ''Precio'',\nIF(cl.facturaxgenerador=0,GROUP_CONCAT(faccl.kilosintegrados SEPARATOR '' | ''),GROUP_CONCAT(facgen.kilosintegrados SEPARATOR '' | '')) AS ''kilos Integrados'',\nIF(cl.facturaxgenerador=0,GROUP_CONCAT(faccl.kiloexcedido SEPARATOR '' | ''),GROUP_CONCAT(facgen.kiloexcedido SEPARATOR '' | '')) AS ''Kilo Excedido'',\nrut.nombre AS ''Ruta'',\nrut.identificador AS ''No. Ruta'',\nCONCAT(ope.nombre,'' '',ope.apaterno,'' '',ope.amaterno) AS ''OPERADOR'',\nDATE_FORMAT( man.fecha_captura,''%d/%m/%Y %H:%i'') as Fecha_Captura,\nman.capturista as Capturista\nFROM generador AS gen\nINNER JOIN relcligen USING(idgenerador)\nINNER JOIN cliente AS cl USING(idcliente)\nINNER JOIN relsuccli USING(idcliente)\nINNER JOIN sucursal AS suc USING(idsucursal)\nINNER JOIN relempsuc USING(idsucursal)\nINNER JOIN empresa AS emp USING(idempresa)\nINNER JOIN relgenman USING(idgenerador)\nINNER JOIN manifiesto AS man USING(idmanifiesto)\nINNER JOIN relmanrut USING(idmanifiesto)\nINNER JOIN ruta AS rut USING(idruta)\nINNER JOIN relrutope USING(idruta)\nINNER JOIN operador AS ope USING(idoperador)\nLEFT JOIN relmanrec USING(idmanifiesto)\nLEFT JOIN recoleccion AS rec USING(idrecoleccion)\nLEFT JOIN relresrec USING(idrecoleccion)\nLEFT JOIN residuo AS res USING(idresiduo)\nLEFT JOIN catalogodet AS cmot ON man.motivo = cmot.idcatalogodet\nLEFT JOIN catalogodet AS cvend ON cl.vendedor = cvend.idcatalogodet\nLEFT JOIN catalogodet AS cfrec ON gen.frecuencia = cfrec.idcatalogodet\nLEFT JOIN relclifac USING(idcliente)\nLEFT JOIN facturacion AS faccl ON relclifac.idfacturacion=faccl.idfacturacion\nLEFT JOIN catalogodet AS ctservcl ON faccl.tiposervicio = ctservcl.idcatalogodet\nLEFT JOIN catalogodet AS ctcobcl ON faccl.tipocobro = ctcobcl.idcatalogodet\nLEFT JOIN relgenfac USING(idgenerador)\nLEFT JOIN facturacion AS facgen ON relgenfac.idfacturacion=facgen.idfacturacion\nLEFT JOIN catalogodet AS ctservgen ON facgen.tiposervicio = ctservgen.idcatalogodet\nLEFT JOIN catalogodet AS ctcobgen ON facgen.tipocobro = ctcobgen.idcatalogodet\n__WHR__\nGROUP BY cl.idcliente, gen.idgenerador, man.idmanifiesto\nORDER BY emp.razonsocial, suc.nombre, CONVERT(cl.identificador,UNSIGNED), CONVERT(gen.identificador,UNSIGNED), man.identificador', 
	parametros = '[\n{ "parametro":"empresa", "campo":"emp.razonsocial", "tipo":"text", "etiqueta":"Empresa", "default":"", "operador":"like" },\n{ "parametro":"sucursal", "campo":"suc.nombre", "tipo":"text", "etiqueta":"Sucursal", "default":"", "operador":"like" },\n{ "parametro":"cliente_inicial", "campo":"cl.identificador", "tipo":"numeric", "etiqueta":"Cliente Inicial", "default":"", "operador":">=" },\n{ "parametro":"cliente_final", "campo":"cl.identificador", "tipo":"numeric", "etiqueta":"Cliente Final", "default":"", "operador":"<=" },\n{ "parametro":"generador_inicial", "campo":"gen.identificador", "tipo":"numeric", "etiqueta":"Generador Inicial", "default":"", "operador":">=" },\n{ "parametro":"generador_final", "campo":"gen.identificador", "tipo":"numeric", "etiqueta":"Generador Final", "default":"", "operador":"<=" },\n{ "parametro":"manifiesto_incial", "campo":"man.identificador", "tipo":"text", "etiqueta":"Manifiesto Inicial", "default":"", "operador":"like" },\n{ "parametro":"manifiesto_final", "campo":"man.identificador", "tipo":"text", "etiqueta":"Manifiesto Final", "default":"", "operador":"like" },\n{ "parametro":"vendedor", "campo":"cvend.descripcion", "tipo":"text", "etiqueta":"Vendedor", "default":"", "operador":"like" },\n{ "parametro":"fecha_servicio_inicial", "campo":"man.fecha", "tipo":"date", "etiqueta":"Fecha Programada Inicial", "default":"", "operador":">=" },\n{ "parametro":"fecha_servicio_final", "campo":"man.fecha", "tipo":"date", "etiqueta":"Fecha Programada Final", "default":"", "operador":"<=" },\n{ "parametro":"capturista", "campo":"man.capturista", "tipo":"text", "etiqueta":"Capturista", "default":"", "operador":"like" },\n{ "parametro":"fecha_captura_inicio", "campo":"man.fecha_captura", "tipo":"date", "etiqueta":"Fecha Captura Inicio", "default":"", "operador":">=" },\n{ "parametro":"fecha_captura_final", "campo":"man.fecha_captura", "tipo":"date", "etiqueta":"Fecha Captura Final", "default":"", "operador":"<=" },\n{ "parametro":"fecha_embarque_inicial", "campo":"man.fechaembarque", "tipo":"date", "etiqueta":"Fecha Embarque Inicial", "default":"", "operador":">=" },\n{ "parametro":"fecha_embarque_final", "campo":"man.fechaembarque", "tipo":"date", "etiqueta":"Fecha Emarque Final", "default":"", "operador":"<=" }\n]'
	WHERE idreporte = 3;